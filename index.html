<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Vaporwave Synthwave Site with Chat</title>
  <!-- Pixel Font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body {
      width:100%; height:100%; overflow-y:auto; background:#000;
      font-family:'Press Start 2P',monospace; position:relative;
    }
    /* Grid background */
    .bg {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background-image:
        repeating-linear-gradient(0deg, rgba(255,255,255,0.1) 0 1px, transparent 1px 20px),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.1) 0 1px, transparent 1px 20px),
        linear-gradient(135deg,#2b0a3d,#7f0a9e 50%,#ff79c6);
      background-size:20px 20px,20px 20px, cover;
      animation:gridMove 12s linear infinite; z-index:1;
    }
    @keyframes gridMove {0%{background-position:0 0;}100%{background-position:100% 100%;}}
    .neon {
      position:fixed; top:-50%; left:-50%; width:200%; height:200%;
      background:repeating-linear-gradient(45deg,rgba(0,255,255,0.15)0,transparent20px),
                 repeating-linear-gradient(-45deg,rgba(255,0,255,0.15)0,transparent20px);
      animation:neonFlicker 3s infinite; z-index:2;
    }
    @keyframes neonFlicker {0%,100%{opacity:.4;}50%{opacity:.1;}}
    .twinkle { position:absolute; background:#fff; border-radius:50%; opacity:0;
      animation:twinkleAnim 2s ease-in-out infinite; z-index:3;
    }
    @keyframes twinkleAnim {0%,100%{opacity:0;}50%{opacity:.8;}}
    .floating-star { position:absolute; font-size:4vw; opacity:0;
      animation:starRise 8s linear forwards, starColor 4s linear infinite;
      z-index:5;
    }
    @keyframes starRise {0%{transform:translateY(0);opacity:1;}100%{transform:translateY(-90vh);opacity:0;}}
    @keyframes starColor {0%{color:red;}16%{color:orange;}32%{color:yellow;}48%{color:green;}64%{color:blue;}80%{color:indigo;}100%{color:violet;}}
    .window {
      position:relative; z-index:4;
      width:90vw; max-width:600px; margin:40px auto;
      background:#c0c0c0; border:2px solid #fff;
      box-shadow:1px 1px 0 #000,-1px -1px 0 #808080;
      overflow:hidden;
    }
    .title-bar { display:flex; justify-content:space-between; align-items:center;
      padding:4px 8px; background:linear-gradient(to right,#000080,#0000cd);
      color:#fff; border-bottom:2px solid #fff;
    }
    .buttons { display:flex; gap:4px; }
    .btn-xp { width:16px; height:16px; background:#ff5c5c; border:1px solid #fff; cursor:pointer; }
    .content { padding:16px; background:#008080; border-top:2px solid #fff; text-align:center; }
    .neon-text { font-size:1.5rem; color:#ff79c6;
      text-shadow:0 0 5px #ff79c6,0 0 20px #ff79c6; animation:textFlicker 1.5s infinite;
    }
    @keyframes textFlicker {0%,100%{opacity:1;}50%{opacity:.5;text-shadow:0 0 10px #00ffff;}}
    p { font-size:.75rem; color:#00ffff; text-shadow:0 0 5px #00ffff; margin:.5rem 0; }
    #player { width:100%; height:315px; border:2px solid #00ffff; border-radius:4px; margin:.5rem 0; }
    .control-btn { margin:.5rem .5rem; padding:.6rem 1.2rem; font-size:.6rem;
      background:#ff79c6; border:2px solid #00ffff; border-radius:6px; cursor:pointer;
      transition:.2s;
    }
    .control-btn:hover { background:#00ffff; transform:scale(1.1); color:#121212; }
    #chat { height:150px; overflow-y:auto; background:rgba(0,0,0,.7);
      margin:1rem 0; padding:1rem; font-family:'Press Start 2P',monospace;
      font-size:1rem; color:#fff; border:2px solid #00ffff;
      animation:rainbowText 5s linear infinite;
    }
    @keyframes rainbowText {0%{color:red;}16%{color:orange;}32%{color:yellow;}48%{color:green;}64%{color:blue;}80%{color:indigo;}100%{color:violet;}}
    #chat-input { width:60%; padding:.6rem; font-size:.6rem; margin:.5rem .5rem; }
    #send-btn { padding:.6rem 1.2rem; font-size:.6rem; }
    .fallback { font-size:.6rem; color:#ff79c6; }
    .fallback a { color:#00ffff; text-decoration:underline; }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="neon"></div>
  <div class="window">
    <div class="title-bar">
      <span>Vaporwave Player</span>
      <div class="buttons"><div class="btn-xp"></div><div class="btn-xp"></div><div class="btn-xp"></div></div>
    </div>
    <div class="content">
      <div class="neon-text">Retro Music On XP</div>
      <p>涼しげなネオンとグリッチの幻想をお楽しみください</p>
      <div id="player"></div>
      <div><button class="control-btn" id="prev">◀︎ Prev</button><button class="control-btn" id="play">Play</button><button class="control-btn" id="next">Next ▶︎</button></div>
      <div id="chat"></div>
      <input id="chat-input" type="text" placeholder="チャットを入力..." />
      <button id="send-btn" class="control-btn">送信</button>
      <p class="fallback">埋め込みがブロックされた場合は <a href="https://www.youtube.com/watch?v=WI4-HUn8dFc&list=PLGa3uxog5E0tb8WmX0STOZRgLZAZX-rAk" target="_blank">こちら</a> をクリック</p>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const chatBox = document.getElementById('chat');
      // Twinkle background stars
      setInterval(() => {
        const t = document.createElement('div'); t.className = 'twinkle';
        const sz = Math.random() * 4 + 2; t.style.width = sz + 'px'; t.style.height = sz + 'px';
        t.style.left = Math.random() * 100 + '%'; t.style.top = Math.random() * 100 + '%';
        document.body.appendChild(t); setTimeout(() => t.remove(), 2500);
      }, 150);
      // Floating stars in chat
      setInterval(() => {
        const s = document.createElement('div'); s.className = 'floating-star'; s.innerText = '★';
        const rect = chatBox.getBoundingClientRect();
        s.style.left = Math.random() * (rect.width - 24) + 'px';
        s.style.top = rect.height + 'px';
        chatBox.appendChild(s); s.addEventListener('animationend', () => s.remove());
      }, 250);
      // Firebase init and chat
      const config = {
        apiKey: "AIzaSyCcNEZGmBSH3U_RlvmAOXYFHbW7dzzbFDE",
        authDomain: "vapor-71b36.firebaseapp.com",
        databaseURL: "https://vapor-71b36-default-rtdb.firebaseio.com/",
        projectId: "vapor-71b36",
        storageBucket: "vapor-71b36.appspot.com",
        messagingSenderId: "344956365850",
        appId: "1:344956365850:web:51ca717cc8dda9838bb5a3"
      };
      firebase.initializeApp(config);
      const db = firebase.database().ref('chat');
      db.on('child_added', snap => {
        const m = snap.val();
        const d = document.createElement('div');
        d.textContent = m;
        chatBox.appendChild(d);
        chatBox.scrollTop = chatBox.scrollHeight;
      });
      document.getElementById('send-btn').addEventListener('click', () => {
        const v = document.getElementById('chat-input').value.trim();
        if (v) {
          db.push(v);
        }
        document.getElementById('chat-input').value = '';
      });
      // YouTube IFrame API load
      const ytTag = document.createElement('script');
      ytTag.src = 'https://www.youtube.com/iframe_api';
      document.head.appendChild(ytTag);
    });
    
    let player;
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        playerVars: {
          listType: 'playlist',
          list: 'PLGa3uxog5E0tb8WmX0STOZRgLZAZX-rAk',
          autoplay: 0,
          controls: 0,
          loop: 1,
          modestbranding: 1,
          origin: location.origin
        },
        events: {
          onReady: function() {
            const playBtn = document.getElementById('play');
            const prevBtn = document.getElementById('prev');
            const nextBtn = document.getElementById('next');
            playBtn.addEventListener('click', () => {
              const state = player.getPlayerState();
              if (state === YT.PlayerState.PLAYING) player.pauseVideo();
              else player.playVideo();
            });
            prevBtn.addEventListener('click', () => player.previousVideo());
            nextBtn.addEventListener('click', () => player.nextVideo());
          }
        }
      });
    }
  </script>
